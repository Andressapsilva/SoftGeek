<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Relat칩rios - SoftGeek</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-stone-950 text-white min-h-screen font-sans">
  <header class="bg-gray-900 border-b-2 border-blue-600 shadow-xl sticky top-0 z-20">
    <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
      <h1 class="text-3xl font-extrabold">SOFT GEEK</h1>
      <nav>
                <a href="{{ url_for('index') }}" class="px-4 py-2 bg-blue-600 rounded text-white hover:bg-blue-700">Voltar</a>
      </nav>
    </div>
  </header>

    <main class="max-w-7xl mx-auto p-4">
        <h2 class="text-2xl font-bold mb-2">Relat칩rio de Compara칞칚o de Algoritmos</h2>
        <div id="relatorioContainer" class="bg-gray-800 p-4 rounded-lg shadow-lg">
            <p class="text-gray-400">Carregando relat칩rio...</p>
        </div>
    </main>

    <script>
        const container = document.getElementById('relatorioContainer');
        const raw = localStorage.getItem('softgeek_relatorio');
        if (!raw) {
            container.innerHTML = '<p class="text-red-400">Nenhum relat칩rio encontrado. Execute uma compara칞칚o a partir da p치gina inicial.</p>';
        } else {
            try {
                const data = JSON.parse(raw);
                const tempos = data.tempos || {hashmap:0,indexada:0,sequencial:0};
                const counts = data.counts || {hashmap:0,indexada:0,sequencial:0};
                const reps = data.representatives || {};
                const termo = data.termo || '';
                const ts = new Date(data.timestamp || Date.now()).toLocaleString();

                container.innerHTML = `
                    <p class="text-xs text-gray-300 mb-2">Relat칩rio gerado para: <strong class="text-white">${termo}</strong> em ${ts}</p>
                    <div class="flex flex-col md:flex-row gap-3">
                        <div class="flex-1 overflow-x-auto">
                            <table class="w-full border-collapse text-xs">
                                <thead>
                                    <tr class="bg-blue-600 text-white font-bold">
                                        <th class="border border-gray-600 p-2 text-left">M칠todo</th>
                                        <th class="border border-gray-600 p-2 text-center">Complexidade</th>
                                        <th class="border border-gray-600 p-2 text-center">Tempo (ms)</th>
                                        <th class="border border-gray-600 p-2 text-center">Resultados</th>
                                        <th class="border border-gray-600 p-2 text-center">ID / Hash</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="bg-gray-700">
                                        <td class="border border-gray-600 p-2">Hashmap (ID)</td>
                                        <td class="border border-gray-600 p-2 text-center">O(1)</td>
                                        <td class="border border-gray-600 p-2 text-right text-green-400 font-bold">${tempos.hashmap.toFixed(4)}</td>
                                        <td class="border border-gray-600 p-2 text-center">${counts.hashmap}</td>
                                        <td class="border border-gray-600 p-2 text-center">${reps.hashmap && reps.hashmap.id ? `${reps.hashmap.id} / ${reps.hashmap.hash}` : '-'}</td>
                                    </tr>
                                    <tr class="bg-gray-700">
                                        <td class="border border-gray-600 p-2">Indexada (T칤tulo)</td>
                                        <td class="border border-gray-600 p-2 text-center">O(n)</td>
                                        <td class="border border-gray-600 p-2 text-right text-yellow-400 font-bold">${tempos.indexada.toFixed(4)}</td>
                                        <td class="border border-gray-600 p-2 text-center">${counts.indexada}</td>
                                        <td class="border border-gray-600 p-2 text-center">${reps.indexada && reps.indexada.id ? `${reps.indexada.id} / ${reps.indexada.hash}` : '-'}</td>
                                    </tr>
                                    <tr class="bg-gray-700">
                                        <td class="border border-gray-600 p-2">Sequencial (Categoria)</td>
                                        <td class="border border-gray-600 p-2 text-center">O(n)</td>
                                        <td class="border border-gray-600 p-2 text-right text-orange-400 font-bold">${tempos.sequencial.toFixed(4)}</td>
                                        <td class="border border-gray-600 p-2 text-center">${counts.sequencial}</td>
                                        <td class="border border-gray-600 p-2 text-center">${reps.sequencial && reps.sequencial.id ? `${reps.sequencial.id} / ${reps.sequencial.hash}` : '-'}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="w-32 flex-shrink-0 flex items-center justify-center">
                            ${data.image_url ? `
                                <img src="${data.image_url}" alt="Imagem" class="rounded-lg shadow-lg object-cover w-32 h-48" onerror="this.onerror=null;this.src='https://via.placeholder.com/128x192?text=Imagem+Ausente'">
                            ` : `
                                <div class="w-32 h-48 bg-gray-700 rounded-lg flex items-center justify-center text-gray-400 text-xs">Sem imagem</div>
                            `}
                        </div>
                    </div>
                    <div id="relatorioSummary" class="mt-2 text-xs lowercase text-gray-400">Carregando resumo...</div>
                    <div class="mt-2 flex gap-2">
                        <a href="{{ url_for('index') }}" class="px-3 py-1 bg-blue-600 rounded text-white text-sm hover:bg-blue-700">Voltar</a>
                        <button id="limparBtn" class="px-3 py-1 bg-gray-600 rounded text-white text-sm hover:bg-gray-700">Limpar relat칩rio</button>
                    </div>
                `;        // Atualiza o resumo de exibi칞칚o (Exibindo X resultados de N)
        const summaryEl = document.getElementById('relatorioSummary');
        const displayed = (counts.indexada && counts.indexada > 0) ? counts.indexada : (counts.hashmap && counts.hashmap > 0) ? counts.hashmap : (counts.sequencial && counts.sequencial > 0) ? counts.sequencial : 0;
        
                // 游뚿 CORRIGIDO: Requisi칞칚o fetch para SoftGeek.csv
        fetch("{{ url_for('static', filename='SoftGeek.csv') }}").then(r => {
          if (!r.ok) throw new Error('N칚o conseguiu carregar SoftGeek.csv');
          return r.text();
        }).then(txt => {
          // Conta linhas n칚o vazias, subtrai 1 se houver header
          const lines = txt.split(/\r?\n/).filter(l => l.trim().length > 0);
          const total = Math.max(0, lines.length - 1); // assume header
          summaryEl.textContent = `Exibindo ${displayed} resultados de ${total}`;
        }).catch(() => {
          // Fallback para data.json
                    // 游뚿 CORRIGIDO: Requisi칞칚o fetch para data.json
          fetch("{{ url_for('static', filename='data.json') }}").then(r => {
            if (!r.ok) throw new Error('N칚o conseguiu carregar data.json');
            return r.json();
          }).then(all => {
            const total = Array.isArray(all) ? all.length : 0;
            summaryEl.textContent = `Exibindo ${displayed} resultados de ${total}`;
          }).catch(() => {
            // Fallback final se nada estiver dispon칤vel
            summaryEl.textContent = `Exibindo ${displayed} resultados`;
          });
        });

        document.getElementById('limparBtn').onclick = () => {
          localStorage.removeItem('softgeek_relatorio');
          container.innerHTML = '<p class="text-yellow-300">Relat칩rio limpo. Volte para gerar novo relat칩rio.</p>';
        };

      } catch (e) {
        container.innerHTML = '<p class="text-red-400">Erro ao ler o relat칩rio. Tente novamente.</p>';
        console.error(e);
      }
    }
  </script>
</body>
</html>
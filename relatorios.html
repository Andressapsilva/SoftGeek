<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Relatórios - SoftGeek</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-stone-950 text-white min-h-screen font-sans">
    <header class="bg-gray-900 border-b-2 border-blue-600 shadow-xl sticky top-0 z-20">
        <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
            <h1 class="text-3xl font-extrabold">SOFT GEEK</h1>
            <nav>
                <a href="index.html" class="text-white hover:text-blue-400">Voltar</a>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-8">
        <h2 class="text-3xl font-bold mb-4">Relatório de Comparação de Algoritmos</h2>
        <div id="relatorioContainer" class="bg-gray-800 p-6 rounded-lg shadow-lg">
            <p class="text-gray-400">Carregando relatório...</p>
        </div>
    </main>

    <script>
        const container = document.getElementById('relatorioContainer');
        const raw = localStorage.getItem('softgeek_relatorio');
        if (!raw) {
            container.innerHTML = '<p class="text-red-400">Nenhum relatório encontrado. Execute uma comparação a partir da página inicial.</p>';
        } else {
            try {
                const data = JSON.parse(raw);
                const tempos = data.tempos || {hashmap:0,indexada:0,sequencial:0};
                const counts = data.counts || {hashmap:0,indexada:0,sequencial:0};
                const reps = data.representatives || {};
                const termo = data.termo || '';
                const ts = new Date(data.timestamp || Date.now()).toLocaleString();

                container.innerHTML = `
                    <p class="text-sm text-gray-200 mb-4">Relatório gerado para: <strong class="text-white">${termo}</strong> em ${ts}</p>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1 overflow-x-auto">
                                <table class="w-full border-collapse text-sm">
                        <thead>
                            <tr class="bg-blue-600 text-white font-bold">
                                <th class="border border-gray-600 p-3 text-left">Método</th>
                                <th class="border border-gray-600 p-3 text-center">Complexidade</th>
                                <th class="border border-gray-600 p-3 text-center">Tempo (ms)</th>
                                <th class="border border-gray-600 p-3 text-center">Resultados</th>
                                <th class="border border-gray-600 p-3 text-center">ID / Hash</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-gray-700">
                                <td class="border border-gray-600 p-3">Hashmap (ID)</td>
                                <td class="border border-gray-600 p-3 text-center">O(1)</td>
                                <td class="border border-gray-600 p-3 text-right text-green-400 font-bold">${tempos.hashmap.toFixed(4)}</td>
                                <td class="border border-gray-600 p-3 text-center">${counts.hashmap}</td>
                                <td class="border border-gray-600 p-3 text-center">${reps.hashmap && reps.hashmap.id ? `${reps.hashmap.id} / ${reps.hashmap.hash}` : '-'}</td>
                            </tr>
                            <tr class="bg-gray-700">
                                <td class="border border-gray-600 p-3">Indexada (Título)</td>
                                <td class="border border-gray-600 p-3 text-center">O(n)</td>
                                <td class="border border-gray-600 p-3 text-right text-yellow-400 font-bold">${tempos.indexada.toFixed(4)}</td>
                                <td class="border border-gray-600 p-3 text-center">${counts.indexada}</td>
                                <td class="border border-gray-600 p-3 text-center">${reps.indexada && reps.indexada.id ? `${reps.indexada.id} / ${reps.indexada.hash}` : '-'}</td>
                            </tr>
                            <tr class="bg-gray-700">
                                <td class="border border-gray-600 p-3">Sequencial (Categoria)</td>
                                <td class="border border-gray-600 p-3 text-center">O(n)</td>
                                <td class="border border-gray-600 p-3 text-right text-orange-400 font-bold">${tempos.sequencial.toFixed(4)}</td>
                                <td class="border border-gray-600 p-3 text-center">${counts.sequencial}</td>
                                <td class="border border-gray-600 p-3 text-center">${reps.sequencial && reps.sequencial.id ? `${reps.sequencial.id} / ${reps.sequencial.hash}` : '-'}</td>
                            </tr>
                        </tbody>
                    </table>
                        </div>
                        <div class="w-44 flex-shrink-0 flex items-center justify-center">
                            ${data.image_url ? `
                                <img src="${data.image_url}" alt="Imagem" class="rounded-lg shadow-lg object-cover w-44 h-64" onerror="this.onerror=null;this.src='https://via.placeholder.com/176x256?text=Imagem+Ausente'">
                            ` : `
                                <div class="w-44 h-64 bg-gray-700 rounded-lg flex items-center justify-center text-gray-400">Sem imagem</div>
                            `}
                        </div>
                    </div>
                    <div id="relatorioSummary" class="mt-4 text-sm lowercase text-gray-400">Carregando resumo...</div>
                    <div class="mt-4 flex gap-2">
                        <a href="index.html" class="px-4 py-2 bg-blue-600 rounded text-white">Voltar</a>
                        <button id="limparBtn" class="px-4 py-2 bg-gray-600 rounded text-white">Limpar relatório</button>
                    </div>
                `;

                // Atualiza o resumo de exibição (Exibindo X resultados de N)
                const summaryEl = document.getElementById('relatorioSummary');
                const displayed = (counts.indexada && counts.indexada > 0) ? counts.indexada : (counts.hashmap && counts.hashmap > 0) ? counts.hashmap : (counts.sequencial && counts.sequencial > 0) ? counts.sequencial : 0;
                // Tenta obter o total a partir do arquivo CSV 'SoftGeek.csv' (banco completo)
                // Se não estiver disponível, recorre a data.json como fallback
                fetch('SoftGeek.csv').then(r => {
                    if (!r.ok) throw new Error('Não conseguiu carregar SoftGeek.csv');
                    return r.text();
                }).then(txt => {
                    // Conta linhas não vazias, subtrai 1 se houver header
                    const lines = txt.split(/\r?\n/).filter(l => l.trim().length > 0);
                    const total = Math.max(0, lines.length - 1); // assume header
                    summaryEl.textContent = `Exibindo ${displayed} resultados de ${total}`;
                }).catch(() => {
                    // Fallback para data.json
                    fetch('data.json').then(r => {
                        if (!r.ok) throw new Error('Não conseguiu carregar data.json');
                        return r.json();
                    }).then(all => {
                        const total = Array.isArray(all) ? all.length : 0;
                        summaryEl.textContent = `Exibindo ${displayed} resultados de ${total}`;
                    }).catch(() => {
                        // Fallback final se nada estiver disponível
                        summaryEl.textContent = `Exibindo ${displayed} resultados`;
                    });
                });

                document.getElementById('limparBtn').onclick = () => {
                    localStorage.removeItem('softgeek_relatorio');
                    container.innerHTML = '<p class="text-yellow-300">Relatório limpo. Volte para gerar novo relatório.</p>';
                };

            } catch (e) {
                container.innerHTML = '<p class="text-red-400">Erro ao ler o relatório. Tente novamente.</p>';
                console.error(e);
            }
        }
    </script>
</body>
</html>
